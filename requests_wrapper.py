try:
    from requests_common import headers_dict_user_agent, user_agent
except (Exception, ) as e:
    from .requests_common import headers_dict_user_agent, user_agent
from requests import Session as requests_Session
from requests import get as requests_get


def get_with_proxy(url, proxy):
    s = Session(Proxy=proxy)
    res = s.get(url)
    return res


def get(url):
    return requests_get(url, headers=headers_dict_user_agent)


class Session(requests_Session):
    def __init__(self, Proxy=None):
        super().__init__()
        self.headers['User-Agent'] = user_agent
        if not Proxy is None:
            self.proxies = {
                'http': 'http://' + Proxy,
                'https': 'https://' + Proxy, }

    def get(self, url, connet_timeout=10, read_time=30):
        # connect timeoutを10秒, read timeoutを30秒に設定
        return super().get(url, timeout=(connet_timeout, read_time))


if __name__ == '__main__':
    example_proxies = ['72.182.145.208:80',
                       '108.179.54.171:80',
                       '40.74.243.24:80',
                       '47.89.241.103:8080',
                       '34.240.231.232:3128',
                       '121.121.125.55:80',
                       '13.80.147.35:80',
                       '207.154.245.20:80',
                       '66.82.144.29:8080',
                       '52.169.139.131:80',
                       '219.127.191.12:80',
                       '204.11.243.74:3128',
                       '184.178.217.66:3128',
                       '45.55.157.204:80',
                       '96.44.148.86:80',
                       '60.248.199.206:80',
                       '40.114.14.173:80',
                       '173.68.185.170:80',
                       '43.249.229.163:8080',
                       '59.106.223.171:60088',
                       '180.235.252.189:60088',
                       '191.102.106.3:8181',
                       '119.207.78.155:80',
                       '89.236.17.106:3128',
                       '163.43.28.199:60088',
                       '51.38.64.76:10000',
                       '185.93.3.123:8080',
                       '145.249.106.107:8118',
                       '159.65.136.198:3128',
                       '140.227.69.54:3128',
                       '133.130.117.241:3128',
                       '154.70.135.212:8080',
                       '93.146.254.172:80',
                       '91.121.162.173:80',
                       '151.80.58.175:80',
                       '128.140.225.41:80',
                       '129.232.179.98:80',
                       '137.74.198.136:80',
                       '137.74.254.242:3128',
                       '138.94.160.176:80',
                       '139.59.153.59:80',
                       '139.59.188.36:80',
                       '14.46.16.29:80',
                       '140.227.71.66:3128',
                       '140.227.8.186:3128',
                       '140.227.81.53:3128',
                       '144.217.82.199:80',
                       '145.239.77.20:80',
                       '148.251.235.82:80',
                       '148.251.85.62:3128',
                       '200.12.130.113:80',
                       '149.129.219.96:80',
                       '150.95.154.91:3128',
                       '157.65.29.152:3128',
                       '157.65.167.21:3128',
                       '200.60.104.68:80',
                       '158.69.150.164:3128',
                       '158.69.150.164:80',
                       '158.69.150.164:8080',
                       '191.252.120.198:8080',
                       '158.69.171.234:80',
                       '159.203.33.72:3128',
                       '185.253.88.10:80',
                       '159.65.168.134:80',
                       '159.89.194.51:80',
                       '163.172.122.68:80',
                       '163.172.181.29:80',
                       '163.172.98.25:80',
                       '163.23.175.48:3128',
                       '164.132.98.51:80',
                       '167.114.224.6:80',
                       '167.99.224.142:3128',
                       '167.99.224.142:53',
                       '167.99.224.142:8080',
                       '170.78.23.245:8080',
                       '171.244.32.140:8080',
                       '175.98.239.87:8888',
                       '14.136.246.173:3128',
                       '140.227.74.7:3128',
                       '118.193.26.18:8080',
                       '211.249.50.216:80',
                       '202.138.127.66:80',
                       '45.79.139.169:80',
                       '185.42.221.246:80',
                       '58.181.39.182:80',
                       '13.95.231.14:80',
                       '163.172.86.64:3128',
                       '13.127.94.56:80',
                       '104.155.103.87:80',
                       '93.17.7.146:80',
                       '47.52.153.167:443',
                       '202.21.32.148:8080',
                       '217.182.92.162:3128',
                       '35.184.23.203:80',
                       '47.75.160.100:80',
                       '209.97.137.43:80',
                       '208.67.183.240:80',
                       '189.125.170.36:80',
                       '158.199.141.106:80',
                       '199.38.114.195:80',
                       '117.102.69.52:80',
                       '199.203.232.124:80',
                       '85.11.114.135:3128',
                       '12.162.8.175:80',
                       '176.108.47.38:3128',
                       '181.113.27.99:80',
                       '212.237.50.160:3128',
                       '187.84.222.153:80',
                       '142.44.247.60:80',
                       '93.190.142.214:80',
                       '219.91.255.179:80',
                       '201.245.172.157:80',
                       '177.4.173.242:80',
                       '192.169.154.178:80',
                       '34.225.249.169:80',
                       '51.255.161.222:80',
                       '115.249.145.202:80',
                       '82.244.233.132:80',
                       '92.222.74.221:80',
                       '170.82.228.42:8080',
                       '91.194.42.51:80',
                       '223.197.56.102:80',
                       '46.4.62.108:80',
                       '93.58.124.32:80',
                       '91.134.221.168:80',
                       '90.187.51.41:8080',
                       '13.250.242.1:80',
                       '67.205.154.3:80',
                       '52.51.186.165:80',
                       '125.212.203.161:80',
                       '47.52.153.167:80',
                       '103.252.163.191:80',
                       '34.240.97.171:3129',
                       '181.49.24.126:8081',
                       '103.20.204.104:80',
                       '46.162.197.248:80',
                       '177.67.83.134:80',
                       '192.169.154.104:80',
                       '192.116.142.153:8080',
                       '187.85.83.2:8080',
                       '119.28.194.66:8888',
                       '140.227.80.64:3128',
                       '140.227.79.52:3128',
                       '140.227.78.54:3128',
                       '140.227.75.72:3128',
                       '140.227.71.55:3128',
                       '140.227.70.51:3128',
                       '140.227.68.82:3128',
                       '140.227.25.111:3128',
                       '133.130.118.134:3128',
                       '147.135.210.114:54566',
                       '188.164.203.26:80',
                       '198.1.122.29:80',
                       '191.252.194.156:3128',
                       '187.86.96.10:8080',
                       '66.70.190.244:8080',
                       '191.252.194.156:80',
                       '191.252.194.156:8080',
                       '189.115.92.71:80',
                       '80.211.181.37:80',
                       '178.62.24.94:80',
                       '66.70.181.148:3128',
                       '176.31.45.117:3128',
                       '209.97.154.41:3128',
                       '66.70.190.244:80',
                       '206.81.5.117:3128',
                       '13.125.196.161:80',
                       '195.49.189.130:80',
                       '59.106.216.142:60088',
                       '59.106.213.57:60088',
                       '59.106.213.54:60088',
                       '59.106.213.216:60088',
                       '59.106.209.106:60088',
                       '54.39.98.138:8080',
                       '54.36.162.123:10000',
                       '54.177.53.69:80',
                       '52.87.190.26:80',
                       '192.111.142.90:3128',
                       '52.208.125.199:80',
                       '51.38.106.25:80',
                       '51.255.235.168:80',
                       '51.255.138.195:9999',
                       '51.15.86.88:3128',
                       '51.15.147.94:80',
                       '5.226.70.68:80',
                       '5.152.217.82:3128',
                       '206.81.5.117:8080',
                       '47.254.27.204:80',
                       '180.253.154.109:80',
                       '209.97.154.41:8080',
                       '46.38.245.178:8080',
                       '198.50.168.208:80',
                       '46.101.172.5:443',
                       '45.76.102.72:8088',
                       '45.116.158.85:53281',
                       '43.245.187.38:53281',
                       '103.253.146.215:8080',
                       '43.228.126.175:80',
                       '41.89.94.43:80',
                       '41.72.198.10:80',
                       '41.72.198.10:3128',
                       '41.190.33.162:8080',
                       '180.253.154.109:8080',
                       '37.187.116.199:80',
                       '34.240.97.171:3130',
                       '34.240.97.171:3128',
                       '34.240.231.232:3129',
                       '191.252.120.162:80',
                       '31.11.177.235:80',
                       '27.133.155.225:60088',
                       '27.133.155.162:60088',
                       '27.133.153.227:60088',
                       '27.133.132.80:60088',
                       '27.133.130.156:3128',
                       '23.100.105.68:3128',
                       '79.113.76.80:8080',
                       '222.122.202.175:80',
                       '220.227.8.74:80',
                       '219.120.3.219:80',
                       '213.6.40.142:80',
                       '213.163.181.33:80',
                       '191.252.120.162:8080',
                       '213.136.86.234:80',
                       '212.72.150.51:8081',
                       '212.56.139.253:80',
                       '212.237.33.61:80',
                       '212.237.29.185:80',
                       '212.200.246.24:80',
                       '211.75.82.206:3128',
                       '209.141.56.170:8080',
                       '206.81.3.55:3128',
                       '202.222.22.188:80',
                       '202.222.22.187:80',
                       '103.211.232.100:8080',
                       '35.237.135.142:8080',
                       '92.117.57.140:8080',
                       '153.127.196.176:60088',
                       '182.72.68.39:80',
                       '41.220.111.125:8080',
                       '81.30.26.80:80',
                       '23.100.106.183:3128',
                       '195.219.102.239:80',
                       '191.252.193.162:8080',
                       '189.8.68.78:80',
                       '23.100.107.150:3128',
                       '157.65.167.23:3128',
                       '191.252.193.162:80',
                       '116.82.121.187:60088',
                       '190.75.193.67:8080',
                       '202.131.233.202:53281',
                       '202.131.229.250:53281',
                       '200.75.105.120:80',
                       '200.54.108.54:80',
                       '200.42.45.211:80',
                       '200.254.125.10:80',
                       '200.232.51.242:80',
                       '200.109.108.137:3128',
                       '198.50.137.181:8080',
                       '198.50.137.181:3128',
                       '196.22.249.124:80',
                       '195.208.172.70:8080',
                       '195.201.7.153:80',
                       '195.201.7.153:443',
                       '195.201.224.231:80',
                       '195.190.148.19:80',
                       '195.178.207.241:80',
                       '195.154.207.153:80',
                       '195.154.168.227:80',
                       '194.8.251.205:80',
                       '192.244.104.3:3128',
                       '191.252.92.198:80',
                       '191.252.120.198:80',
                       '191.252.120.198:3128',
                       '191.252.1.236:80',
                       '190.82.70.109:80',
                       '190.128.162.70:80',
                       '189.8.68.78:8080',
                       '188.192.138.183:80',
                       '188.166.175.238:80',
                       '188.166.119.186:80',
                       '188.165.240.92:3128',
                       '188.120.228.19:80',
                       '188.111.84.107:80',
                       '187.217.189.229:8081',
                       '186.71.20.154:80',
                       '185.229.224.61:80',
                       '18.222.124.59:8080',
                       '178.62.76.18:81',
                       '178.49.139.13:80',
                       '178.33.37.215:9999',
                       '178.33.178.217:80',
                       '177.72.56.155:3128',
                       '177.54.142.222:8080',
                       '177.204.85.203:80',
                       '176.53.2.122:8080',
                       '109.233.125.171:10098',
                       '175.139.252.193:80',
                       '158.58.172.207:14826',
                       '139.255.57.32:8080',
                       '163.43.31.6:60088',
                       '163.43.31.107:60088',
                       '163.43.30.9:60088',
                       '163.43.30.42:60088',
                       '163.43.29.181:60088',
                       '163.43.29.166:60088',
                       '163.43.28.30:60088',
                       '163.43.28.237:60088',
                       '163.43.28.172:60088',
                       '160.16.201.57:60088',
                       '159.89.163.248:53281',
                       '153.127.217.166:60088',
                       '153.127.216.249:60088',
                       '153.127.215.246:60088',
                       '153.127.203.112:60088',
                       '153.127.201.235:60088',
                       '153.127.201.147:60088',
                       '153.127.201.127:60088',
                       '153.127.199.19:60088',
                       '153.127.198.98:60088',
                       '153.127.198.128:60088',
                       '153.127.196.201:60088',
                       '153.127.195.6:60088',
                       '153.127.195.28:60088',
                       '153.127.194.248:60088',
                       '153.125.129.235:60088',
                       '153.125.129.225:60088',
                       '153.125.128.98:60088',
                       '153.125.128.237:60088',
                       '153.120.170.206:60088',
                       '153.120.170.129:60088',
                       '153.120.170.101:60088',
                       '153.120.167.192:60088',
                       '153.120.166.9:60088',
                       '153.120.166.64:60088',
                       '153.120.166.62:60088',
                       '149.56.103.185:10000',
                       '149.56.103.184:10000',
                       '133.242.237.62:60088',
                       '133.242.235.119:60088',
                       '133.242.231.184:60088',
                       '133.242.230.13:60088',
                       '133.242.228.188:60088',
                       '133.242.228.111:60088',
                       '133.242.224.27:60088',
                       '123.31.47.8:3128',
                       '123.30.172.60:3128',
                       '119.28.21.144:8080',
                       '119.28.142.148:8888',
                       '117.74.125.192:8088',
                       '117.102.88.121:80',
                       '116.197.135.172:3128',
                       '115.84.179.249:7777',
                       '114.202.2.185:80',
                       '113.190.235.188:2016',
                       '111.68.108.34:8080',
                       '109.251.106.8:8010',
                       '109.108.146.157:80',
                       '107.172.48.172:9999',
                       '103.83.233.161:8080',
                       '103.63.109.19:3128',
                       '103.3.70.133:80',
                       '103.252.163.119:3128',
                       '79.190.145.140:3128',
                       '83.64.253.168:80',
                       '95.85.50.218:80',
                       '59.106.223.57:60088',
                       '80.211.226.156:80',
                       '83.169.6.43:80',
                       '77.82.87.125:8081',
                       '81.107.70.221:80',
                       '85.93.177.178:80',
                       '80.211.189.165:3128',
                       '79.190.145.141:3128',
                       '59.106.220.187:60088',
                       '59.106.222.74:60088',
                       '88.99.215.14:80',
                       '59.106.218.51:60088',
                       '91.121.88.53:80',
                       '62.80.223.139:80',
                       '92.222.213.107:3128',
                       '195.222.7.59:9999',
                       '223.19.51.247:8383',
                       '60.250.79.187:80',
                       '159.89.205.205:8118',
                       '94.130.20.85:31288',
                       '59.106.218.101:60088',
                       '79.137.85.204:80',
                       '92.222.83.160:80',
                       '79.190.145.142:3128',
                       '90.45.26.244:80',
                       '74.209.243.116:3128',
                       '86.119.40.127:80',
                       '82.208.98.202:80',
                       '87.139.146.191:8080',
                       '67.205.148.246:3128',
                       '91.203.240.210:80',
                       '88.99.149.188:31288',
                       '80.211.181.37:3128',
                       '67.205.148.246:53',
                       '99.52.192.30:8080',
                       '59.106.217.16:60088',
                       '80.211.157.173:80',
                       '66.154.103.39:80',
                       '204.11.243.70:3128',
                       '67.205.148.246:8080',
                       '52.42.234.31:80',
                       '35.234.129.7:80',
                       '35.230.34.45:80',
                       '140.227.9.100:3128',
                       '145.239.93.131:80',
                       '64.88.186.84:80',
                       '75.128.59.155:80',
                       '207.154.194.13:80',
                       '145.249.105.25:8118',
                       '140.227.30.123:3128',
                       '140.227.26.111:3128',
                       '171.255.199.129:80',
                       '165.90.11.18:8080',
                       '159.65.182.63:80',
                       '159.65.175.251:80',
                       '149.56.45.68:10000',
                       '132.148.150.41:80',
                       '109.196.34.51:8080',
                       '144.217.105.153:80',
                       '169.239.126.150:3128',
                       '159.65.168.7:80',
                       '176.31.125.111:80',
                       '221.139.49.46:80',
                       '133.242.224.79:60088',
                       '193.105.155.168:80',
                       '178.60.28.98:9999',
                       '5.39.27.169:80',
                       '159.65.164.108:80',
                       '202.21.116.186:53281',
                       '34.240.231.232:3130',
                       '168.235.93.162:8080',
                       '46.218.85.101:3129',
                       '150.242.180.151:80',
                       '189.76.81.14:20183',
                       '123.176.43.144:9090',
                       '149.56.243.207:80',
                       '5.189.168.151:80',
                       '167.114.196.153:80',
                       '58.97.81.11:80',
                       '150.95.147.66:3128',
                       '140.227.74.74:3128',
                       '140.227.80.50:3128',
                       '178.33.39.195:9999',
                       '140.227.73.83:3128',
                       '176.107.110.112:80',
                       '144.217.246.237:9090',
                       '140.227.81.69:3128',
                       '140.227.82.51:3128',
                       '93.190.142.240:80',
                       '85.126.244.82:8080',
                       '62.210.73.38:80',
                       '91.134.137.233:80',
                       '59.106.218.188:60088',
                       '52.193.131.15:8080',
                       '52.193.131.15:80',
                       '187.84.187.4:8383',
                       '184.172.238.18:80',
                       '45.6.216.79:80',
                       '159.89.163.248:80',
                       '138.197.170.108:80',
                       '167.99.93.3:8080',
                       '150.95.190.145:3128',
                       '187.110.238.133:3130',
                       '160.16.75.109:80',
                       '185.26.52.133:80',
                       '195.13.50.212:8118',
                       '138.201.223.250:31288',
                       '223.19.51.247:8380',
                       '104.131.214.218:80',
                       '46.246.42.171:3128',
                       '139.162.3.174:8118',
                       '103.20.205.197:80',
                       '193.194.69.202:8090',
                       '195.245.214.107:3128',
                       '188.120.232.181:8118',
                       '163.43.30.191:60088',
                       '189.8.68.78:3128']
    test_url = "https://auctions.yahoo.co.jp/closedsearch/closedsearch?ei=UTF-8&n=100&auccat=26318&istatus=1&s1=bids&o1=a"
    # test_url = "https://auctions.yahoo.co.jp/jp/show/bid_hist?aID=q204067425&u=%3bformer_0229"
    from lxml.html import fromstring
    from threading import Thread

    def test_get_with_proxy(url, proxy):
        print(proxy)
        try:
            res = get_with_proxy(url, proxy)
            lxmlroot = fromstring(res.text)
            bidhistory_trs = lxmlroot.xpath(
                "//title")[0].text_content()
            print(bidhistory_trs)
        except (Exception, ) as e:
            raise
            print(e)
    for proxy in example_proxies[:30]:
        Thread(target=test_get_with_proxy,  args=(test_url, proxy)).start()
